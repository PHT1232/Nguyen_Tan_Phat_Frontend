<p-toast></p-toast>
<div [@routerTransition]>
    <div class="modal-body">
        <div class="container-add">
            <div class="container-row">
              <div class="row" style="padding-bottom: 25px">
                <div class="col">
                  <div class="row">
                    <div class="col required">
                      <label for="name">
                        {{ "Mã đơn" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <!-- <input
                        type="text"
                        class="form-control"
                        name="expensesCode"
                        id="expensesCode"
                        required
                        [(ngModel)]="expenses.expensesCode"
                        #nameCode="ngModel"
                        #nameCodeEl
                        maxlength="32"
                      /> -->
                      <input
                      pInputText
                      type="text"
                      required
                      [style]="{'width':'100%'}"
                      [ngModelOptions]="{ standalone: true }"
                      [(ngModel)]="expenses.expensesCode"
                      #nameModel="ngModel"
                      #nameEl
                        />
                      <abp-validation-summary
                        [control]="nameModel"
                        [controlEl]="nameEl"
                      ></abp-validation-summary>
                    </div>
                    <div class="col">
                      <p-button
                        label="Random"
                        (click)="getRandomCode()"
                        >
                        </p-button>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <label for="name">
                        {{ "Người lập phiếu" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                        <p-dropdown [style]="{'width':'100%'}" 
                        [options]="employee" 
                        [(ngModel)]="employeeSelected" 
                        [ngModelOptions]="{standalone: true}" 
                        optionLabel="name" [filter]="true" filterBy="name" [showClear]="true" placeholder="Nhân viên">
                        </p-dropdown>      
                      <!-- <abp-validation-summary [control]="nameModel" [controlEl]="nameEl"></abp-validation-summary> -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" style="padding-bottom: 25px">
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <label for="name">
                        {{ "Nhà cung cấp" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <!-- <input
                      type="text"
                      class="form-control"
                      name="nameOfExport"
                      id="nameOfExport"
                      required
                      [(ngModel)]="expenses.productProvider"
                      #nameCode="ngModel"
                      #nameCodeEl
                      maxlength="32"
                    /> -->
                    <input
                      pInputText
                      type="text"
                      required
                      [style]="{'width':'100%'}"
                      [ngModelOptions]="{ standalone: true }"
                      [(ngModel)]="expenses.productProvider"
                      #nameCode="ngModel"
                      #nameCodeEl
                    />
                    <abp-validation-summary
                      [control]="nameCode"
                      [controlEl]="nameCodeEl"
                    ></abp-validation-summary>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="row">
                    <div class="col required">
                      <label for="name">
                        {{ "Kho nhập" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <!-- <select class="form-control" [(ngModel)]="storageCodeInput" [ngModelOptions]="{standalone: true}" aria-label="Default select example">
                        <option value="0">Kho</option>
                        <option *ngFor="let storage of getStorage.items;let i = index" value="{{storage.storageCode}}">{{storage.storageName}}</option>
                      </select> -->
                      <p-dropdown [style]="{'width':'100%'}" 
                      [options]="getStorage" 
                      [(ngModel)]="storageCode" 
                      [ngModelOptions]="{standalone: true}" 
                      optionLabel="name" [filter]="true" filterBy="name" [showClear]="true" placeholder="Kho">
                      </p-dropdown>
                      <!-- <abp-validation-summary [control]="nameCode" [controlEl]="nameCodeEl"></abp-validation-summary> -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" style="padding-bottom: 25px">
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <label for="name">
                        {{ "Chiết khấu" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                    <!-- <input
                      pInputText
                      type="text"
                      required
                      [style]="{'width':'100%'}"
                      [ngModelOptions]="{ standalone: true }"
                      [(ngModel)]="expenses.discount"
                      #nameCode="ngModel"
                      #nameCodeEl
                    /> -->
                    <p-inputNumber 
                    class="pinputnumber"
                    [(ngModel)]="expenses.discount" 
                    [style]="{'width':'100%'}" 
                    inputStyleClass="{'width':'100%'}"
                    inputId="percent" 
                    prefix="%"   
                    #nameNumber="ngModel"
                    #nameNumberEl> </p-inputNumber>
                    <abp-validation-summary
                      [control]="nameNumber"
                      [controlEl]="nameNumberEl"
                    ></abp-validation-summary>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="row">
                    <div class="col required">
                      <label for="name">
                        {{ "Ngày thanh toán" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                        <p-calendar
                        dateFormat="dd/mm/yy"
                        [style]="{'width':'100%'}"
                        [(ngModel)]="expenses.paymentDate"
                        [showIcon]="true"
                        [ngModelOptions]="{ standalone: true }"
                      ></p-calendar>
                      <!-- <abp-validation-summary [control]="nameCode" [controlEl]="nameCodeEl"></abp-validation-summary> -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" style="padding-bottom: 25px">
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <label for="name">
                        {{ "Diễn giải" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                    <input
                      pInputText
                      type="text"
                      required
                      [style]="{'width':'100%'}"
                      [ngModelOptions]="{ standalone: true }"
                      [(ngModel)]="expenses.description"
                      #nameDescription="ngModel"
                      #nameDescriptionEl
                    />
                    <abp-validation-summary
                      [control]="nameDescription"
                      [controlEl]="nameDescriptionEl"
                    ></abp-validation-summary>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" style="padding-bottom: 25px">
                <div class="col">
                  <div class="row" style="margin-bottom: 25px">
                    <div class="col">
                      <label for="name">
                        {{ "Sản phẩm" | localize }}
                      </label>
                      <span
                        style="color: red; margin-left: 5px; font-size: 14pt"
                        >*</span
                      >
                    </div>
                  </div>
                  <div class="row">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <button
                          type="button"
                          class="btn bg-blue"
                          (click)="search(0)"
                        >
                          <i class="fas fa-search"></i>
                        </button>
                      </div>
                      <input
                        type="text"
                        class="form-control"
                        name="keyword"
                        [placeholder]="'SearchWithThreeDot' | localize"
                        [(ngModel)]="keyword"
                        (keyup.enter)="search(0)"
                      />
                    </div>
                  </div>
                  <div class="row" style="margin-top: 15px">
                    <div class="table-responsive">
                      <table class="table table-striped table-bordered"
                      >
                        <thead class="bg-light">
                          <tr>
                            <th>{{ "Mã sản phẩm" | localize }}</th>
                            <th>{{ "Tên sản phẩm" | localize }}</th>
                            <th>{{ "Số lượng" | localize }}</th>
                            <th>{{ "Vị trí" | localize }}</th>
                            <th>{{ "Đơn vị tính" | localize }}</th>
                            <th>{{ "Giá" | localize }}</th>
                            <th>{{ "Đơn giá" | localize }}</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let product of products1; let i = index">
                            <td>{{ product.productId }}</td>
                            <td>{{ product.productName }}</td>
                            <td style="width: 90px">
                              <input
                                [disabled]="quantityCheck[i]"
                                min="1"
                                type="number"
                                class="form-control"
                                value="{{ product.quantity }}"
                                style="width: 80px"
                                [(ngModel)]="product.quantity"
                                [ngModelOptions]="{standalone: true}"
                                (change)="changeQuantity(product)"
                              />
                            </td>
                            <td style="width: 90px">
                              <input
                                [disabled]="quantityCheck[i]"
                                type="text"
                                class="form-control"
                                style="width: 80px"
                                [(ngModel)]="product.location"
                                [ngModelOptions]="{standalone: true}"
                              />
                            </td>
                            <td>{{ product.unit }}</td>
                            <td>{{ product.price | currency : "VND" }}</td>
                            <td [innerHTML]="product.finalPrice | currency: 'VND'"></td>
                            <td style="width: 35px">
                              <input
                                type="checkbox"
                                class="form-control"
                                (change)="AddItem(product, i)"
                                style="width: 25px; height: 25px"
                              />
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer justify-content-center">
                <p-paginator
                  (onPageChange)="getDataPage($event)"
                  [first]="first"
                  [rows]="rows"
                  [totalRecords]="totalItems"
                  [rowsPerPageOptions]="[5, 10, 15]"
                ></p-paginator>
                <!-- <button
                type="button"
                class="btn btn-default"
                [disabled]="saving"
                (click)="Cancel()"
              >
                Hủy
              </button>
              <button type="button" (click)="save2()" class="btn btn-primary" [disabled]="checkFormValid()">
                Lưu
              </button> -->
                <p-button
                type="button"
                [disabled]="saving"
                (click)="Cancel()"
                styleClass="p-button-outlined"
                label="Hủy"
                >
                </p-button>
                <p-button type="button" label="Lưu" (click)="save2()" [disabled]="checkFormValid()">
                <!-- {{ saveLabel }} -->
                </p-button>  
              </div>    
            </div>
          </div>
    </div>
</div>
